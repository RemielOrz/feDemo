define(["OE","ITouchMove"],function(a,b){function c(b){"object"!=typeof b&&(b={}),this.options=e.extend({},{el:".wrapper",appendTo:"body",tpl:a.BASE_URL+"/template/menu/menu.html"},b),this.$el=e(this.options.el),this.init()}console.log("module:Menu");var d=a.utils,e=a.$;return c.prototype={init:function(){e.get(this.options.tpl,e.proxy(function(a){this.$menu=e(e(a).html()),this.$menu.css({height:e(window).height()+"px"}).appendTo(this.options.appendTo),this.$icon=e('<i class="oefont-menu menu__icon"></i>').appendTo(this.options.el),this.bindEvt()},this))},toggleMenu:function(){this.$menu.css({top:this.$menu.height()+document.body.scrollTop>this.$el.height()?this.$el.height()-this.$menu.height()+"px":document.body.scrollTop+"px",height:e(window).height()+"px"}).add(this.$icon).toggleClass("_active"),this.$el.add("body").toggleClass("__menu_active").removeClass("_disable-transform"),this.isActive=this.$el.hasClass("__menu_active")},bindEvt:function(){this.elSwipe(),this.iTouchMove(),this.$icon.on(d.events.up+".menu",e.proxy(function(a){a.stopPropagation(),a.preventDefault(),this.toggleMenu(),console.log("click menu-icon",a)},this)),e("body").on(d.events.move+".menu",".__menu_active",e.proxy(function(a){this.isActive&&a.preventDefault()},this))},elSwipe:function(){var a,b,c,f,g,h,i=Math.abs;this.$el.on(d.events.down+".menu",e.proxy(function(c){this.isActive&&c.preventDefault(),a=d.getCursorPosition(c),b=a.x,g=1,h=0},this)),this.$el.on(d.events.move+".menu",e.proxy(function(b){var e=d.getCursorPosition(b);a&&(c=e.x-a.x,f=e.y-a.y,h||i(c)>i(f)+1&&c>1?(h=1,b.preventDefault(),g=0):i(c)>i(f)+1&&-1>c?(g=1,b.preventDefault()):g=1)},this)),this.$el.on(d.events.up+".menu",e.proxy(function(a){this.isActive?(a.preventDefault(),this.toggleMenu()):!g&&this.toggleMenu()},this)),this.$el.on("webkitTransitionEnd.menu",e.proxy(function(){this.isActive||this.$el.addClass("_disable-transform")},this))},iTouchMove:function(){new b(this.$menu)}},a.ui.Menu=c,c});